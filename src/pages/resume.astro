---
import PageLayout from "../layouts/PageLayout.astro";
import TOC from "../components/TOC.astro";
import RevealOnScroll from "../components/RevealOnScroll.astro";
import GitHubIcon from "../components/icons/GitHubIcon.astro";
import LinkedInIcon from "../components/icons/LinkedInIcon.astro";
import CodeCopy from "../components/CodeCopy.astro";
import { getCollection, render } from "astro:content";

const resumes = await getCollection("resume");
const resume = resumes.find((r) => r.slug === "resume") ?? resumes[0];
if (!resume) throw new Error("Resume content not found");

const { Content, headings } = await render(resume);

const showTOC = headings.length >= 3;
---

<PageLayout
  title={resume.data.title}
  description={(resume.data as { description?: string }).description ?? "Rose Freixas â€” Education and work experience"}
>
  <section class="mx-auto max-w-5xl px-4 py-16 sm:px-6 lg:px-8">
    <RevealOnScroll>
      <div class="card-linkedin mb-12 flex flex-col items-center text-center">
        <p class="mb-4 text-[rgb(var(--c-text))]">
          For the most up-to-date experience and details, please visit my
          LinkedIn.
        </p>
        <a
          href="https://www.linkedin.com/in/rosefr"
          class="btn-linkedin inline-flex"
          target="_blank"
          rel="noopener noreferrer"
        >
          <LinkedInIcon size={18} />
          LinkedIn
        </a>
      </div>
    </RevealOnScroll>

    <article class="mx-auto max-w-3xl">
      <RevealOnScroll>
        <h1 class="section-heading-rosie mb-8">{resume.data.title}</h1>
      </RevealOnScroll>
      <div class={showTOC ? "lg:grid lg:grid-cols-[1fr_200px] lg:gap-12" : ""}>
        <div>
          <RevealOnScroll>
            <CodeCopy client:load>
              <div class="prose-custom">
                <Content />
              </div>
            </CodeCopy>
          </RevealOnScroll>
          <RevealOnScroll>
            <section class="mt-12 border-t border-border pt-8">
              <h2 class="text-lg font-semibold mb-4">See my work</h2>
              <div class="flex flex-wrap gap-4 mb-8">
                <a href="/projects/" class="btn-solid-yellow">
                  My Projects
                </a>
                <a
                  href="https://github.com/therivetedrose"
                  class="btn-github"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <GitHubIcon size={18} />
                  GitHub
                </a>
              </div>
            </section>
          </RevealOnScroll>
          <RevealOnScroll>
            <section class="border-t border-border pt-8">
              <h2 class="text-lg font-semibold mb-4">Connect with me</h2>
              <div class="flex flex-wrap gap-4">
                <a
                  href="https://www.linkedin.com/in/rosefr"
                  class="btn-linkedin"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <LinkedInIcon size={18} />
                  LinkedIn
                </a>
              </div>
            </section>
          </RevealOnScroll>
        </div>
        {showTOC && (
          <aside class="hidden lg:block">
            <TOC headings={headings} />
          </aside>
        )}
      </div>
    </article>
  </section>
</PageLayout>
