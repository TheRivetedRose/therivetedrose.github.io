---
import ProjectLayout from '../../layouts/ProjectLayout.astro';
import { getCollection, render } from 'astro:content';
import CodeCopy from '../../components/CodeCopy.astro';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content, headings } = await render(project);
const dateOpts: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric' };
const formattedPubDate = project.data.pubDate?.toLocaleDateString('en-US', dateOpts);
const formattedUpdatedDate = project.data.updatedDate?.toLocaleDateString('en-US', dateOpts);
const showUpdated = project.data.updatedDate && project.data.pubDate && project.data.updatedDate.getTime() !== project.data.pubDate.getTime();
---

<ProjectLayout
  title={project.data.title}
  description={project.data.summary}
  workInProgress={project.data.workInProgress}
  headings={headings.map((h) => ({ depth: h.depth, slug: h.slug, text: h.text }))}
>
  <header class="mb-8">
    <h1 class="section-heading mb-4 text-rosie-yellow">{project.data.title}</h1>
    {(formattedPubDate || formattedUpdatedDate) && (
      <p class="mb-4 flex flex-wrap justify-between gap-x-4 gap-y-1 text-sm text-muted">
        {formattedPubDate && <span><span class="font-medium">Published:</span> {formattedPubDate}</span>}
        {showUpdated && formattedUpdatedDate && (
          <span><span class="font-medium">Updated:</span> {formattedUpdatedDate}</span>
        )}
      </p>
    )}
    <p class="mb-4 text-[rgb(var(--c-text))]">{project.data.summary}</p>
    <div class="flex flex-wrap gap-2">
      {project.data.tags.map((tag) => (
        <span class="badge">{tag}</span>
      ))}
    </div>
    {project.data.repoUrl && (
      <a href={project.data.repoUrl} class="btn-solid-red mt-4" target="_blank" rel="noopener noreferrer">
        View Repository
      </a>
    )}
  </header>
  <CodeCopy client:load>
    <div class="prose-custom">
      <Content />
    </div>
  </CodeCopy>
</ProjectLayout>
